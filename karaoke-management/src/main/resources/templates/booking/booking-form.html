<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  th:replace="layout/main-layout :: layout(${booking.id == null ? 'Tạo đặt phòng' : 'Cập nhật đặt phòng'}, 'booking', ~{::pageHead}, ~{::section})"
>
  <th:block th:fragment="pageHead">
    <!-- Flatpickr -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  </th:block>

  <section>
    <div class="topbar">
      <div>
        <h2
          class="page-title"
          th:text="${booking.id == null ? 'Tạo đặt phòng' : 'Cập nhật đặt phòng'}"
        >
          TẠO ĐẶT PHÒNG
        </h2>
        <div class="help-text">
          Nhập thông tin khách, chọn phòng và thời gian.
        </div>
      </div>

      <a class="btn btn-outline" th:href="@{/booking}">← Quay lại</a>
    </div>

    <div class="card">
      <div th:if="${error}" class="alert"><b th:text="${error}">Error</b></div>

      <form
        th:action="${booking.id == null ? '/booking/save' : '/booking/update'}"
        method="post"
      >
        <input
          type="hidden"
          name="id"
          th:if="${booking.id != null}"
          th:value="${booking.id}"
        />

        <h3 style="margin-top: 0">1. Thông tin khách hàng</h3>
        <div class="form-row">
          <div class="field">
            <label>Tên khách</label>
            <input
              class="input"
              type="text"
              name="customerName"
              th:value="${booking.customerName}"
              required
            />
          </div>

          <div class="field">
            <label>Số điện thoại</label>
            <input
              class="input"
              type="text"
              name="customerPhone"
              th:value="${booking.customerPhone}"
              required
            />
          </div>
        </div>

        <div class="hr"></div>

        <h3>2. Chọn phòng</h3>
        <div class="form-row">
          <div class="field">
            <label>Phòng</label>
            <select class="input" name="roomId" required>
              <option value="">-- Chọn phòng --</option>
              <option
                th:each="r : ${rooms}"
                th:value="${r.id}"
                th:text="${r.name}"
                th:selected="${booking.room != null && booking.room.id == r.id}"
              ></option>
            </select>
          </div>

          <div class="field">
            <label>Trạng thái booking</label>
            <select class="input" name="status" required>
              <option
                th:each="s : ${T(com.karaoke_management.entity.BookingStatus).values()}"
                th:value="${s}"
                th:text="${s}"
                th:selected="${booking.status == s}"
              ></option>
            </select>
          </div>
        </div>

        <div class="hr"></div>

        <h3>3. Thời gian đặt phòng</h3>
        <div class="form-row">
          <div class="field">
            <label>Giờ bắt đầu</label>
            <input
              class="input datetime-picker"
              type="text"
              name="startTime"
              th:value="${startTimeStr != null ? startTimeStr : ''}"
              placeholder="dd/MM/yyyy HH:mm"
              required
              autocomplete="off"
            />
          </div>

          <div class="field">
            <label>Giờ kết thúc</label>
            <input
              class="input datetime-picker"
              type="text"
              name="endTime"
              th:value="${endTimeStr != null ? endTimeStr : ''}"
              placeholder="dd/MM/yyyy HH:mm"
              required
              autocomplete="off"
            />
          </div>
        </div>

        <p class="help-text">
          Định dạng: <b>dd/MM/yyyy HH:mm</b> • Ví dụ: <i>26/01/2026 20:30</i>
        </p>

        <div class="hr"></div>

        <div class="form-actions">
          <button class="btn btn-primary" type="submit">
            <span
              th:text="${booking.id == null ? 'Lưu booking' : 'Cập nhật booking'}"
            ></span>
          </button>
          <a class="btn btn-outline" th:href="@{/booking}">Hủy</a>
        </div>
      </form>
    </div>

    <script>
      flatpickr(".datetime-picker", {
        enableTime: true,
        time_24hr: true,
        dateFormat: "d/m/Y H:i",
        allowInput: false,
      });
    </script>
  </section>
</html>
