<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  th:replace="layout/main-layout :: layout('Hóa đơn', 'invoices', ~{::pageHead}, ~{::section})"
>
  <th:block th:fragment="pageHead">
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
      .filter {
        display: grid;
        grid-template-columns: repeat(6, minmax(140px, 1fr));
        gap: 12px;
        align-items: end;
      }
      .filter .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .filter .field label {
        font-size: 12px;
        color: #6b7280;
      }
      .filter .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: end;
      }
      .filter .note {
        grid-column: 1 / -1;
        font-size: 12px;
        color: #6b7280;
        margin-top: 2px;
      }
      @media (max-width: 1100px) {
        .filter {
          grid-template-columns: repeat(2, minmax(160px, 1fr));
        }
      }
    </style>
  </th:block>

  <section>
    <div class="topbar">
      <div>
        <h2 class="page-title">Danh sách hóa đơn</h2>
        <div class="help-text">Lọc theo thời gian, khoảng tiền và phòng.</div>
      </div>
    </div>

    <div class="card">
      <!-- FILTER -->
      <form method="get" th:action="@{/invoice}" class="filter">
        <div class="field">
          <label>Từ</label>
          <input
            class="input datetime-picker"
            type="text"
            name="from"
            th:value="${from}"
            placeholder="HH:mm dd/MM/yyyy"
            autocomplete="off"
          />
        </div>

        <div class="field">
          <label>Đến</label>
          <input
            class="input datetime-picker"
            type="text"
            name="to"
            th:value="${to}"
            placeholder="HH:mm dd/MM/yyyy"
            autocomplete="off"
          />
        </div>

        <div class="field">
          <label>Tối thiểu</label>
          <input
            class="input"
            type="number"
            step="1000"
            name="min"
            th:value="${min}"
            placeholder="0"
          />
        </div>

        <div class="field">
          <label>Tối đa</label>
          <input
            class="input"
            type="number"
            step="1000"
            name="max"
            th:value="${max}"
            placeholder="0"
          />
        </div>

        <div class="field">
          <label>Phòng</label>
          <select class="input" name="roomId">
            <option value="" th:selected="${roomId == null}">
              Tất cả phòng
            </option>
            <option
              th:each="r : ${rooms}"
              th:value="${r.id}"
              th:text="${r.name}"
              th:selected="${roomId != null and roomId == r.id}"
            >
              P101
            </option>
          </select>
        </div>

        <div class="actions">
          <button class="btn btn-primary" type="submit">Lọc</button>
          <a class="btn btn-outline" th:href="@{/invoice}">Xóa lọc</a>
        </div>

        <div class="note">
          Định dạng: <b th:text="${dtPattern}">HH:mm dd/MM/yyyy</b> (VD: 20:30
          26/01/2026)
        </div>
      </form>

      <div class="hr"></div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th style="width: 80px">ID</th>
              <th style="width: 110px">Session</th>
              <th style="width: 110px">Phòng</th>
              <th style="width: 160px">Tổng tiền</th>
              <th style="width: 180px">Tạo lúc</th>
              <th style="width: 140px">Trạng thái</th>
              <th style="width: 180px">Thanh toán lúc</th>
              <th style="width: 140px">Hành động</th>
            </tr>
          </thead>

          <tbody>
            <tr th:if="${#lists.isEmpty(invoices)}">
              <td
                colspan="8"
                style="text-align: center; color: #6b7280; padding: 18px"
              >
                Không có hóa đơn
              </td>
            </tr>

            <tr th:each="inv : ${invoices}">
              <td th:text="${inv.id}">1</td>

              <td
                th:text="${inv.roomSession != null ? inv.roomSession.id : ''}"
              >
                17
              </td>

              <td
                th:text="${(inv.roomSession != null and inv.roomSession.room != null) ? inv.roomSession.room.name : ''}"
              >
                P101
              </td>

              <td>
                <b
                  th:text="${#numbers.formatDecimal(inv.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' đ'"
                >
                  100,000 đ
                </b>
              </td>

              <td
                th:text="${inv.createdAt != null ? #temporals.format(inv.createdAt, 'HH:mm dd/MM/yyyy') : ''}"
              >
                20:30 26/01/2026
              </td>

              <td>
                <span class="badge badge-muted" th:text="${inv.status}"
                  >PAID</span
                >
              </td>

              <td
                th:text="${inv.paidAt != null ? #temporals.format(inv.paidAt, 'HH:mm dd/MM/yyyy') : ''}"
              >
                21:45 26/01/2026
              </td>

              <td>
                <a
                  class="btn btn-outline btn-sm"
                  th:href="@{/invoice/{id}(id=${inv.id})}"
                  >Chi tiết</a
                >
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      flatpickr(".datetime-picker", {
        enableTime: true,
        time_24hr: true,
        dateFormat: "H:i d/m/Y",
        allowInput: false,
      });
    </script>
  </section>
</html>
