<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Chi tiết hóa đơn</title>
  </head>
  <body>
    <h2>Chi tiết hóa đơn</h2>

    <p>
      <a th:href="@{/invoice}">← Danh sách hóa đơn</a> |
      <a th:href="@{/dashboard}">Dashboard</a>
    </p>

    <hr />

    <div>
      <p><b>ID:</b> <span th:text="${invoice.id}">1</span></p>
      <p>
        <b>Tổng tiền:</b> <span th:text="${invoice.totalAmount}">0</span> VND
      </p>
      <p><b>Trạng thái:</b> <span th:text="${invoice.status}">UNPAID</span></p>
      <p th:if="${invoice.paidAt != null}">
        <b>Đã thanh toán lúc:</b> <span th:text="${invoice.paidAt}">time</span>
      </p>
      <p th:if="${invoice.vnpTransactionNo != null}">
        <b>VNPay TransactionNo:</b>
        <span th:text="${invoice.vnpTransactionNo}">xxx</span>
      </p>
    </div>

    <hr />

    <!-- Chỉ hiện nút thanh toán nếu chưa PAID -->
    <form
      th:if="${invoice.status != T(com.karaoke_management.entity.InvoiceStatus).PAID}"
      th:action="@{/payment/vnpay/create}"
      method="post"
    >
      <input type="hidden" name="invoiceId" th:value="${invoice.id}" />
      <button type="submit">Thanh toán VNPay</button>
    </form>

    <!-- Auto refresh nhẹ mỗi 3s nếu chưa paid (để realtime trạng thái sau IPN) -->
    <script th:inline="javascript">
      const status = /*[[${invoice.status}]]*/ "UNPAID";
      if (status !== "PAID") {
        setTimeout(() => location.reload(), 3000);
      }
    </script>
  </body>
</html>
