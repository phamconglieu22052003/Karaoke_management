<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title
      th:text="${booking != null && booking.id != null ? 'Sửa đặt phòng' : 'Thêm đặt phòng'}"
    >
      Đặt phòng
    </title>
  </head>
  <body>
    <h2
      th:text="${booking != null && booking.id != null ? 'Sửa đặt phòng' : 'Thêm đặt phòng'}"
    >
      Đặt phòng
    </h2>

    <p>
      <a th:href="@{/booking}">← Quay lại danh sách đặt phòng</a>
    </p>

    <div
      th:if="${error}"
      style="color: red; margin: 8px 0"
      th:text="${error}"
    ></div>

    <!-- =================== CREATE FORM =================== -->
    <form
      th:if="${booking == null || booking.id == null}"
      th:action="@{/booking/save}"
      method="post"
    >
      <!-- ✅ THÊM 2 Ô NÀY CHO /booking/new -->
      <div style="margin-bottom: 10px">
        <label>Tên khách:</label><br />
        <input
          type="text"
          name="customerName"
          required
          th:value="${booking != null ? booking.customerName : ''}"
        />
      </div>

      <div style="margin-bottom: 10px">
        <label>Số điện thoại:</label><br />
        <input
          type="text"
          name="phone"
          th:value="${booking != null ? booking.phone : ''}"
        />
      </div>

      <div style="margin: 8px 0">
        <label>Phòng</label><br />
        <select name="roomId" required>
          <option th:each="r : ${rooms}" th:value="${r.id}" th:text="${r.name}">
            P101
          </option>
        </select>
      </div>

      <div style="margin: 8px 0">
        <label>Giờ bắt đầu</label><br />
        <input
          type="datetime-local"
          name="startTime"
          required
          th:value="${booking != null && booking.startTime != null ? #temporals.format(booking.startTime,'yyyy-MM-dd''T''HH:mm') : ''}"
        />
      </div>

      <div style="margin: 8px 0">
        <label>Giờ kết thúc</label><br />
        <input
          type="datetime-local"
          name="endTime"
          required
          th:value="${booking != null && booking.endTime != null ? #temporals.format(booking.endTime,'yyyy-MM-dd''T''HH:mm') : ''}"
        />
      </div>

      <div style="margin: 8px 0">
        <label>Trạng thái</label><br />
        <select name="status" required>
          <option
            th:each="st : ${T(com.karaoke_management.entity.BookingStatus).values()}"
            th:value="${st}"
            th:text="${st}"
            th:selected="${booking != null && booking.status == st}"
          >
            BOOKED
          </option>
        </select>
      </div>

      <div style="margin-top: 12px">
        <button type="submit">Lưu đặt phòng</button>
        <a th:href="@{/booking}" style="margin-left: 10px">Hủy</a>
      </div>
    </form>

    <!-- =================== UPDATE FORM =================== -->
    <form
      th:if="${booking != null && booking.id != null}"
      th:action="@{/booking/update}"
      method="post"
    >
      <input type="hidden" name="id" th:value="${booking.id}" />

      <div style="margin-bottom: 10px">
        <label>Tên khách:</label><br />
        <input
          type="text"
          name="customerName"
          required
          th:value="${booking.customerName}"
        />
      </div>

      <div style="margin-bottom: 10px">
        <label>Số điện thoại:</label><br />
        <input type="text" name="phone" th:value="${booking.phone}" />
      </div>

      <div style="margin: 8px 0">
        <label>Phòng</label><br />
        <select name="roomId" required>
          <option
            th:each="r : ${rooms}"
            th:value="${r.id}"
            th:text="${r.name}"
            th:selected="${booking.room != null && booking.room.id == r.id}"
          >
            P101
          </option>
        </select>
      </div>

      <div style="margin: 8px 0">
        <label>Giờ bắt đầu</label><br />
        <input
          type="datetime-local"
          name="startTime"
          required
          th:value="${booking.startTime != null ? #temporals.format(booking.startTime,'yyyy-MM-dd''T''HH:mm') : ''}"
        />
      </div>

      <div style="margin: 8px 0">
        <label>Giờ kết thúc</label><br />
        <input
          type="datetime-local"
          name="endTime"
          required
          th:value="${booking.endTime != null ? #temporals.format(booking.endTime,'yyyy-MM-dd''T''HH:mm') : ''}"
        />
      </div>

      <div style="margin: 8px 0">
        <label>Trạng thái</label><br />
        <select name="status" required>
          <option
            th:each="st : ${T(com.karaoke_management.entity.BookingStatus).values()}"
            th:value="${st}"
            th:text="${st}"
            th:selected="${booking.status == st}"
          >
            BOOKED
          </option>
        </select>
      </div>

      <div style="margin-top: 12px">
        <button type="submit">Cập nhật đặt phòng</button>
        <a th:href="@{/booking}" style="margin-left: 10px">Hủy</a>
      </div>
    </form>
  </body>
</html>
